-12,7 +12,7 @@
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png"/>
  <link rel="stylesheet" href="/static/style.css"/>

  <!-- âœ… OneSignal Web SDK (v16) -->
  <!-- âœ… OneSignal Web SDK -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
</head>

@@ -24,11 +24,17 @@
    <h1>Ø¨Ø³Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ â€” Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªÙ„Ø®ÙŠØµ</h1>

    <!-- Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div style="text-align:center;margin:12px 0;">
      <button id="enablePush" class="btn btn-alt" style="padding:10px 18px;border-radius:10px;cursor:pointer;">
        ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
      </button>
      <p id="pushStatus" style="font-size:13px;color:#9ca3af;margin-top:6px;">
    <div style="text-align:center;margin:14px 0;">
      <button id="enablePush" style="
        background:#7c3aed;
        color:#fff;
        border:none;
        border-radius:12px;
        padding:10px 20px;
        font-size:16px;
        cursor:pointer;
      ">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
      <p id="pushHint" style="font-size:13px;color:#a1a1aa;margin-top:6px;">
        Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØºÙ„Ù‚.
      </p>
    </div>
@@ -109,54 +115,68 @@ <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ({{ engine_used }})</h3>
  <!-- Ø³ÙƒØ±Ø¨ØªØ§Øª Ø§Ù„ØµÙØ­Ø© -->
  <script src="/static/app.js"></script>

  <!-- âœ… ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª OneSignal ÙˆØ²Ø± Ø§Ù„Ø¬Ø±Ø³ -->
  <!-- âœ… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª OneSignal Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© -->
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      // ØªÙ‡ÙŠØ¦Ø© OneSignal
      await OneSignal.init({
        appId: "81c7fcd0-8dbe-4486-9f9e-7a80e461f5d1", // App ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        appId: "81c7fcd0-8dbe-4486-9f9e-7a80e461f5d1",
        serviceWorkerPath: "/OneSignalSDKWorker.js",
        serviceWorkerUpdaterPath: "/OneSignalSDKUpdaterWorker.js",
        serviceWorkerParam: { scope: "/" },
        allowLocalhostAsSecureOrigin: true
      });

      const btn = document.getElementById('enablePush');
      const status = document.getElementById('pushStatus');
      const btn = document.getElementById("enablePush");
      const hint = document.getElementById("pushHint");

      // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø±
      async function refreshState() {
        try {
          const perm = await OneSignal.Notifications.getPermissionState(); // granted | denied | default
          const sub = await OneSignal.User.PushSubscription.get();

          if (perm === "denied") {
            btn.textContent = "ğŸš« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø©";
            btn.style.background = "#dc2626";
            btn.disabled = true;
            hint.textContent = "Ø§ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ø³Ù…Ø­ Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.";
            return;
          }

          if (sub && sub.optedIn) {
            btn.textContent = "âœ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…ÙØ¹Ù‘Ù„Ø©";
            btn.style.background = "#16a34a";
            btn.style.color = "#fff";
            btn.disabled = true;
            status.textContent = "Ø³ØªØµÙ„Ùƒ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØºÙ„Ù‚.";
            hint.textContent = "Ø³ØªØµÙ„Ùƒ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØºÙ„Ù‚.";
          } else {
            btn.textContent = "ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª";
            btn.style.background = "#7c3aed";
            btn.style.color = "#fff";
            btn.disabled = false;
            status.textContent = "Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø±.";
            hint.textContent = "Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø±.";
          }
        } catch(e) {
          console.log("State error", e);
        } catch (e) {
          console.error(e);
        }
      }

      // Ø²Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„
      btn.addEventListener('click', async () => {
      // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
      btn.addEventListener("click", async () => {
        try {
          await OneSignal.Slidedown.promptPush({ force: true });
          await refreshState();
        } catch(e) {
          console.log("Prompt error", e);
          await OneSignal.Notifications.requestPermission();
          await OneSignal.User.PushSubscription.optIn();
        } catch (e) {
          console.error(e);
        }
        await refreshState();
      });

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø£ÙŠ ØªØºÙŠÙŠØ± Ù…Ù† OneSignal
      OneSignal.User.PushSubscription.addEventListener('change', refreshState);
      // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª
      OneSignal.Notifications.addEventListener("permissionChange", refreshState);
      OneSignal.User.PushSubscription.addEventListener("change", refreshState);

      // Ø­Ø§Ù„Ø© Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      // ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø£ÙˆÙ„ Ù…Ø±Ø©
      await refreshState();
    });
  </
