<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ุจุณุงู ุงูุฐูู โ ุจุญุซ ุนููู ูุชูุฎูุต ุชููุงุฆู</title>
  <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>
<header>
  <h1>๐ ุจุณุงู ุงูุฐูู โ ุจุญุซ ุนููู ูุชูุฎูุต ุชููุงุฆู</h1>
</header>

<section class="card">
  <form id="searchForm">
    <input id="q" placeholder="ุงูุชุจ ุณุคุงูู ููุง..."/>
    <label><input type="checkbox" id="want_social"/> ุชูุนูู ุงูุจุญุซ ุงูุงุฌุชูุงุนู (ุฃุณูุงุก/ุญุณุงุจุงุช)</label>
    <button type="submit">ุฅุฑุณุงู</button>
  </form>
</section>

<section id="result" class="card" hidden>
  <h3>ุงูุฅุฌุงุจุฉ:</h3>
  <div id="answer"></div>
  <h4>ุงููุตุงุฏุฑ:</h4>
  <ul id="sources"></ul>
  <div id="social"></div>
</section>

<script>
const form = document.getElementById("searchForm");
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const q = document.getElementById("q").value;
  const want_social = document.getElementById("want_social").checked;
  const resDiv = document.getElementById("result");
  const ans = document.getElementById("answer");
  const src = document.getElementById("sources");
  const soc = document.getElementById("social");

  ans.innerText = "โณ ุฌุงุฑู ุงูุจุญุซ...";
  resDiv.hidden = false;
  src.innerHTML = "";
  soc.innerHTML = "";

  const res = await fetch("/search", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ q, want_social })
  });
  const data = await res.json();

  if (!data.ok) { ans.innerText = "ุญุฏุซ ุฎุทุฃ: " + data.error; return; }

  ans.innerText = data.answer;
  data.sources.forEach(l => {
    const li = document.createElement("li");
    li.innerHTML = `<a href="${l}" target="_blank">${l}</a>`;
    src.appendChild(li);
  });

  if (data.social && data.social.length > 0) {
    soc.innerHTML = "<h4>ุจุญุซ ุงุฌุชูุงุนู ุณุฑูุน:</h4><ul>" +
      data.social.map(s => `<li><a href="${s.split(': ')[1]}" target="_blank">${s}</a></li>`).join('') +
      "</ul>";
  }
});
</script>
</body>
</html>
