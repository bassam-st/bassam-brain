<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ุจุณุงู ุงูุฐูู โ ุจุญุซ ุนููู</title>
  <link rel="manifest" href="/static/pwa/manifest.json">
  <meta name="theme-color" content="#0b0f19"/>
  <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>
<header class="top">
  <h1>ุจุณุงู ุงูุฐูู โ ุจุญุซ ุนููู ูุชูุฎูุต ุชููุงุฆู</h1>
  <div class="actions">
    <button id="installBtn" hidden>ุชุซุจูุช ุงูุชุทุจูู</button>
    <button id="themeBtn" title="ุงููุถุน ุงููููู/ุงูููุงุฑู">๐/โ๏ธ</button>
  </div>
</header>

<section class="card">
  <form id="searchForm" class="row">
    <input id="q" placeholder="ุงูุชุจ ุณุคุงููโฆ"/>
    <label class="chk"><input type="checkbox" id="want_prices"/> ุฑูุงุจุท ุงูุฃุณุนุงุฑ</label>
    <button>ุจุญุซ</button>
  </form>

  <div id="answer" class="answer-box">โฆ</div>
  <div id="sources" class="sources"></div>
</section>

<footer>
  <p>ยฉ Bassam AI 2025 โข <a href="/admin/health">ุญุงูุฉ ุงููุธุงู</a></p>
</footer>

<script>
async function postJSON(url, data){
  const r = await fetch(url, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  });
  return r.json();
}

function el(id){ return document.getElementById(id); }

async function doSearch(e){
  e.preventDefault();
  el("answer").textContent = "โฆ ุฌุงุฑู ุงูุจุญุซ";
  el("sources").innerHTML = "";
  const q = el("q").value.trim();
  const want_prices = el("want_prices").checked;
  try{
    const res = await postJSON("/search", { q, want_prices });
    if(!res.ok){ throw new Error(res.error || "ูุดู ุงูุจุญุซ"); }
    el("answer").textContent = res.answer || "ูู ุฃุฌุฏ ูุชูุฌุฉ";
    if(res.sources?.length){
      const srcs = res.sources.map(s=>`<li><a href="${s.url}" target="_blank">${s.title}</a></li>`).join("");
      el("sources").innerHTML = `<h3>ุงููุตุงุฏุฑ:</h3><ul>${srcs}</ul>`;
    }
  }catch(err){
    el("answer").textContent = "ุญุฏุซ ุฎุทุฃ: " + err.message;
  }
}

document.getElementById("searchForm").addEventListener("submit", doSearch);

// ุฒุฑ ุงูุชุจุฏูู ุจูู ุงููุถุน ุงููููู ูุงูููุงุฑู
const themeBtn = document.getElementById("themeBtn");
themeBtn.onclick = ()=>{
  const dark = document.body.classList.toggle("dark");
  localStorage.setItem("theme", dark ? "dark" : "light");
};
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");

// ุฒุฑ ุชุซุจูุช ุงูุชุทุจูู PWA
window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  const installBtn = document.getElementById("installBtn");
  installBtn.hidden = false;
  installBtn.onclick = ()=> e.prompt();
});
</script>
</body>
</html>
