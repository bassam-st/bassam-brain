<script>
document.addEventListener("DOMContentLoaded", () => {
  const form   = document.getElementById("searchForm");
  const input  = document.getElementById("q");
  const price  = document.getElementById("price_links"); // ØµÙ†Ø¯ÙˆÙ‚ "Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø¹Ø§Ø±" Ø¥Ù† ÙˆØ¬Ø¯
  const btn    = document.getElementById("goBtn");       // Ø²Ø± "Ø¨Ø­Ø«"
  const answer = document.getElementById("answer");      // Ù…ÙƒØ§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©

  async function doSearch(e){
    e.preventDefault();               // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    const q = (input.value || "").trim();
    if (!q){ input.focus(); return; }

    // Ø­Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨Ø³ÙŠØ·Ø©
    btn.disabled = true;
    const old = btn.innerText;
    btn.innerText = "ÙŠØ¨Ø­Ø«â€¦";
    answer.innerHTML = `<div class="loading">ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„â€¦</div>`;

    try{
      const fd = new FormData();
      fd.append("q", q);
      if (price && price.checked) fd.append("price_links", "on");

      const res = await fetch("/search", { method: "POST", body: fd });
      if (!res.ok){
        const txt = await res.text();
        throw new Error("HTTP " + res.status + ": " + txt);
      }
      const html = await res.text();     // Ø§Ù„Ù€ backend ÙŠÙØ±Ø¬Ø¹ HTML Ø¬Ø§Ù‡Ø²
      answer.innerHTML = html;
    }catch(err){
      console.error(err);
      answer.innerHTML = `
        <div class="error">
          Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«. Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
          <pre style="white-space:pre-wrap">${String(err)}</pre>
        </div>`;
    }finally{
      btn.disabled = false;
      btn.innerText = old;
    }
  }

  form.addEventListener("submit", doSearch);
});
</script>
