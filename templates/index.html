<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ุจุณูุงู ุงูุฐูู โ ุงูุนูู ุงููุฒุฏูุฌ</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <main class="container">
    <header class="hero">
      <h1>ุจุณูุงู ุงูุฐูู โ <span>ุงูุนูู ุงููุฒุฏูุฌ</span> ๐ค</h1>
      <p>ูุณุชูุจู ุณุคุงูู โ ููุญููู ููุตุญูุญ ุฅููุงุฆูุงู โ ูุจุญุซ ุฃููุงู ูู ุงููุงุนุฏุฉุ
         ูุฅู ูุฒู ูุจุญุซ ูู ุงูููุจ (Google &amp; Bing ุนุจุฑ DuckDuckGo) โ
         ูููุฎูุต ููุนุฑุถ <strong>ูุตุงุฏุฑ ูุงุจูุฉ ููููุฑ</strong>.</p>
    </header>

    <section class="card">
      <form method="post" action="/ask" class="ask-form">
        <label for="q">ุงูุชุจ ุณุคุงูู ููุง</label>
        <textarea id="q" name="q" rows="3" placeholder="ูุซุงู: ูุง ูู ุนุงุตูุฉ ุฃููุงููุงุ ุฃู: ุงูุชุจ ุนู ุงูุฐูุงุก ุงูุงุตุทูุงุนู...">{{ q }}</textarea>

        <!-- ุฎูุงุฑุงุช ุฅุถุงููุฉ ูุณุชูุจููุง: ุญูุธ ูู ุงููุงุนุฏุฉ -->
        <div class="inline">
          <label class="switch">
            <input type="checkbox" name="save_answer">
            <span>ุญูุธ ูุฐู ุงูุฅุฌุงุจุฉ ูู ุงููุงุนุฏุฉ ูุงุญููุง</span>
          </label>
          <button type="submit" class="btn">ุฅุฑุณุงู</button>
        </div>

        <!-- ุชูุฑูุฑ ุขุฎุฑ ุฅุฌุงุจุฉ ูู ุชูุญูุธ ุฅู ุงุฎุชุงุฑ ุงููุณุชุฎุฏู -->
        <input type="hidden" name="last_answer" value="{{ ans or '' }}">
      </form>
    </section>

    {% if ans %}
    <section class="card answer">
      <h2>ุงูุฅุฌุงุจุฉ</h2>
      <pre class="bubble">{{ ans }}</pre>

      {% if meta and meta.sources and meta.sources|length > 0 %}
      <section class="card sources">
        <h3>ุงููุตุงุฏุฑ</h3>
        <ul id="sources-list">
          {% for s in meta.sources %}
            <li class="source-item {% if loop.index > 5 %}hidden{% endif %}">
              <a href="{{ s.url }}" target="_blank" rel="noopener">{{ s.title }}</a>
            </li>
          {% endfor %}
        </ul>
        {% if meta.sources|length > 5 %}
        <div class="sources-actions">
          <button id="more-btn" class="btn-ghost">ุนุฑุถ ุงููุฒูุฏ</button>
          <button id="less-btn" class="btn-ghost hidden">ุนุฑุถ ุฃูู</button>
        </div>
        {% endif %}
      </section>
      {% endif %}

      <form method="post" action="/back">
        <button class="btn-ghost">โ ุฑุฌูุน</button>
      </form>

      <div class="mode">mode: {{ meta.mode if meta else "n/a" }}</div>
    </section>
    {% endif %}
  </main>

  <script>
  // ุชุญูู ูู "ุนุฑุถ ุงููุฒูุฏ/ุฃูู" ูููุตุงุฏุฑ
  (function(){
    const list  = document.getElementById('sources-list');
    if(!list) return;
    const items = Array.from(list.querySelectorAll('.source-item'));
    const more  = document.getElementById('more-btn');
    const less  = document.getElementById('less-btn');
    let shown = Math.min(5, items.length);
    function showMore(n=5){
      const end = Math.min(shown+n, items.length);
      for(let i=shown;i<end;i++) items[i].classList.remove('hidden');
      shown=end; updateBtns();
    }
    function showLess(){
      items.forEach((li,i)=> li.classList.toggle('hidden', i>=5));
      shown=Math.min(5,items.length); updateBtns();
    }
    function updateBtns(){
      if(more) more.classList.toggle('hidden', shown>=items.length);
      if(less) less.classList.toggle('hidden', shown<=5);
    }
    if(more) more.addEventListener('click', ()=>showMore(5));
    if(less) less.addEventListener('click', showLess);
    updateBtns();
  })();
  </script>
</body>
</html>
