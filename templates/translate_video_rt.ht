<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ğŸ§ ØªØ±Ø¬Ù…Ø© Ø­ÙŠÙ‘Ø© â€” Ø¨Ø³Ø§Ù… Ø¨Ø±Ø§ÙŠÙ†</title>
  <style>
    body{background:#0b0f19;color:#e5e7eb;font-family:system-ui,Arial;padding:18px;text-align:center}
    h2{color:#c4b5fd;margin:10px 0 18px}
    form{margin-bottom:16px}
    input{padding:10px;border-radius:10px;border:none;width:70%;max-width:560px;background:#0f1421;color:#fff}
    button{padding:10px 16px;border:none;border-radius:10px;background:#7c3aed;color:#fff;cursor:pointer;margin-top:10px}
    video{width:100%;max-width:960px;margin:16px auto;border-radius:14px;display:block;background:#000}
    .subs{max-width:960px;margin:10px auto;text-align:right;background:#111827;border:1px solid #2a2f45;border-radius:14px;padding:12px}
    .line{padding:6px 8px;border-bottom:1px dashed #2a2f45}
    .muted{color:#9ca3af}
    .error{color:#ef4444}
  </style>
</head>
<body>
  <h2>ğŸ¬ Ø¨Ø³Ø§Ù… â€” ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø­ÙŠÙ‘Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h2>
  <form method="post" action="/translate_video_rt">
    <input type="text" name="video_url" placeholder="Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§..." required/>
    <div><button type="submit">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¢Ù† ğŸ§</button></div>
  </form>

  {% if video_url %}
    <video controls autoplay src="{{ video_url }}"></video>

    <div id="subs" class="subs">
      <div class="line muted">Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­ÙŠØ©... Ù‡Ø°Ø§ Ø¹Ø±Ø¶ ØªØ¬Ø±ÙŠØ¨ÙŠ.</div>
    </div>

    <script>
      (function () {
        const url = "{{ video_url }}";
        const subs = document.getElementById('subs');
        const ev = new EventSource('/sse_subs?url=' + encodeURIComponent(url));

        function addLine(html, cls="") {
          const div = document.createElement('div');
          div.className = 'line ' + cls;
          div.innerHTML = html;
          subs.appendChild(div);
          subs.scrollTop = subs.scrollHeight;
        }

        ev.onmessage = (e) => {
          try {
            const data = JSON.parse(e.data);
            if (data.type === 'final') {
              addLine(`<b>Ø§Ù„ØªØ±Ø¬Ù…Ø©:</b> ${data.ar}<br><span class="muted">(${data.src})</span>`);
            } else if (data.type === 'fallback') {
              addLine('âš ï¸ ' + data.msg, 'muted');
            } else if (data.type === 'info') {
              addLine('â„¹ï¸ ' + data.msg, 'muted');
            } else if (data.type === 'error') {
              addLine('âŒ ' + data.msg, 'error');
            } else if (data.type === 'done') {
              addLine('âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©.');
              ev.close();
            }
          } catch (err) {
            addLine('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ø«.', 'error');
          }
        };

        ev.onerror = () => {
          addLine('âŒ Ø§Ù†Ù‚Ø·Ø¹ Ø¨Ø« Ø§Ù„ØªØ±Ø¬Ù…Ø©.', 'error');
          ev.close();
        };
      })();
    </script>
  {% endif %}
</body>
</html>
